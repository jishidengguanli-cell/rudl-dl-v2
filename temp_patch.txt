
*** Begin Patch
*** Update File: src/app/api/admin/members/[id]/route.ts
@@
   if (!DB) {
     return jsonError('D1_NOT_AVAILABLE', 500);
   }
 
   const adminUser = await fetchAdminUser(DB, uid);
   if (!adminUser) {
     return jsonError('FORBIDDEN', 403);
   }
 
+  await ensurePointTables(DB);
+
   let payload: Partial<{
     role: unknown;
     setBalance: unknown;
     adjustBalance: unknown;
   }>;
@@
-    const hasBalanceColumn = await hasUsersBalanceColumn(DB);
+    const hasBalanceColumn = await hasUsersBalanceColumn(DB);
+    const hasLegacyUpdatedAt = hasBalanceColumn ? false : await hasPointAccountsUpdatedAt(DB);
@@
-        updates.push(
-          DB.prepare('INSERT OR IGNORE INTO point_accounts (id, balance, updated_at) VALUES (?, ?, ?)')
-            .bind(memberId, 0, now)
-            .run()
-            .catch(() => undefined)
-        );
-        updates.push(
-          DB.prepare('UPDATE point_accounts SET balance=?, updated_at=? WHERE id=?')
-            .bind(workingBalance, now, memberId)
-            .run()
-        );
+        if (hasLegacyUpdatedAt) {
+          updates.push(
+            DB.prepare('INSERT OR IGNORE INTO point_accounts (id, balance, updated_at) VALUES (?, ?, ?)')
+              .bind(memberId, 0, now)
+              .run()
+              .catch(() => undefined)
+          );
+          updates.push(
+            DB.prepare('UPDATE point_accounts SET balance=?, updated_at=? WHERE id=?')
+              .bind(workingBalance, now, memberId)
+              .run()
+          );
+        } else {
+          updates.push(
+            DB.prepare('INSERT OR IGNORE INTO point_accounts (id, balance) VALUES (?, 0)')
+              .bind(memberId)
+              .run()
+              .catch(() => undefined)
+          );
+          updates.push(
+            DB.prepare('UPDATE point_accounts SET balance=? WHERE id=?')
+              .bind(workingBalance, memberId)
+              .run()
+          );
+        }
       }
     }
*** End Patch
